# テストルール

このドキュメントは、プロジェクトで使用するテストの粒度と配置ルールを定義します。

> **Note**: テストコードも[コーディング規約](./coding-rules.md)に従う必要があります。

## テストの粒度

### ユニットテスト

**目的**: 個々の関数やクラスの単一責任を検証する

- **対象**: 関数レベル、クラスレベルの個別ロジック
- **依存関係**: モック化またはスタブ化する
- **配置場所**: ソースファイルと同じディレクトリ（co-location）
- **命名パターン**: `<filename>.test.ts`

#### Co-locationアプローチの利点

1. **保守性の向上**: テストと実装コードが同じ場所にあるため、変更時に見つけやすい
2. **可読性の向上**: ファイル構造がシンプルになり、関連ファイルをすぐに特定できる
3. **リファクタリングの容易さ**: ファイル移動時にテストも一緒に移動できる
4. **削除漏れの防止**: 実装コード削除時にテストの削除も忘れにくい

#### 例

```
src/
  utils/
    math.ts
    math.test.ts          # ← ユニットテスト
  components/
    Player.ts
    Player.test.ts        # ← ユニットテスト
```

### インテグレーションテスト

**目的**: 複数のコンポーネントやモジュール間の連携を検証する

- **対象**: 複数のクラスや関数の統合動作
- **依存関係**: 実際のコンポーネントを使用（一部モック化も許容）
- **配置場所**: `tests/integration/`
- **命名パターン**: `<feature>.test.ts`

#### 例

```
tests/
  integration/
    maze-navigation.test.ts     # ← Maze + Player の統合テスト
    game-state.test.ts          # ← ゲーム全体の状態管理テスト
```

### E2Eテスト（End-to-End）

**目的**: アプリケーション全体の動作をエンドユーザーの視点で検証する

- **対象**: フルスタックの動作（UI操作からバックエンド処理まで）
- **依存関係**: 実際のシステム全体を使用
- **配置場所**: `tests/e2e/`
- **命名パターン**: `<scenario>.test.ts`

#### 例

```
tests/
  e2e/
    game-playthrough.test.ts           # ← ゲーム開始から終了までのシナリオ
    maze-completion.test.ts            # ← 迷路クリアまでの一連の流れ
```

## テスト実装の指針

### ユニットテストの指針

- 1つの関数/メソッドにつき、1つのテストファイル
- テストケースは「正常系」「異常系」「境界値」を網羅する
- 外部依存（API、DB、ファイルシステムなど）は必ずモック化する
- テストは独立して実行可能であること（他のテストに依存しない）

### インテグレーションテストの指針

- 機能単位でテストファイルを作成する
- コンポーネント間のインターフェースを重点的に検証する
- 実際のデータフローを確認する
- モックは最小限に抑え、実際の統合を検証する

### E2Eテストの指針

- ユーザーストーリーやシナリオ単位でテストを作成する
- 実際のユーザー操作を再現する
- パフォーマンスや応答時間も考慮する
- 重要なユースケースに絞り込む（全機能を網羅する必要はない）

## テスト実行

```bash
# すべてのテストを実行
npm test

# ユニットテストのみ実行
npm test -- --exclude "tests/**"

# インテグレーションテストのみ実行
npm test -- tests/integration

# E2Eテストのみ実行
npm test -- tests/e2e

# カバレッジレポート生成
npm test -- --coverage
```

## 参考資料

- [コーディング規約](./coding-rules.md) - テストコードも本規約に従います
- [Testing Library Documentation](https://testing-library.com/) - フロントエンドテストのベストプラクティス
- [Vitest Documentation](https://vitest.dev/) - 使用しているテストフレームワーク
