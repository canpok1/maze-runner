---
name: optimize-issue-labels
description: GitHub Issueのラベル（story/task）を内容に基づいて最適化します。
argument-hint: "<Issue番号...>"
---

## 概要

引数で指定された複数のGitHub Issueについて、内容を分析しstory/taskラベルの適切な付与・削除を行うコマンドです。

## 手順

1. 引数の確認
   - `$ARGUMENTS` からIssue番号を取得する（スペース区切り、`#` プレフィックスは除去）
   - 引数未指定時は「Issue番号を指定してください」と報告して終了

2. 各Issueについて情報取得（可能な限り並列実行）
   - `github` スキル（`issue-get.sh`）でIssueの内容（タイトル、本文、ラベル）を取得
   - `github` スキル（`issue-sub-issues.sh`）でサブIssueの有無を確認

3. 各Issueの判定
   以下の基準で story/task を判定する:

   **story候補の条件**:
   - サブIssueが1つ以上存在する
   - 本文がユーザーストーリー形式（「〜として、〜したい」等）で記述されている
   - 受け入れ条件セクションがある

   **task候補の条件**:
   サブIssueを持たないIssueであり、かつ以下のいずれかの条件を満たすもの:
   - 本文に「親ストーリー」セクションまたは親Issueへの参照（`#数字`形式でのリンク）がある
   - 具体的な実装内容・完了条件が記述されている

   **判定結果**:
   - **storyと判定**: story候補の条件を満たし、task候補の条件を満たさない場合
     → `story` ラベルを付与し、`task` ラベルがあれば削除
   - **taskと判定**: task候補の条件を満たし、story候補の条件を満たさない場合
     → `task` ラベルを付与し、`story` ラベルがあれば削除
   - **矛盾（両方に該当）**: story候補とtask候補の両方の条件を満たす場合
     → `story` と `task` 両方のラベルを削除し、エラーメッセージを表示
   - **判定不能（どちらにも該当しない）**: どちらの条件も満たさない場合
     → ラベル変更なし、判定不能の旨を報告

4. ラベル操作
   - `github` スキル（`issue-update.sh`）の `--add-label` / `--remove-label` を使用
   - story/task以外のラベルは一切変更しない
   - 既に正しいラベルが付与されている場合は変更不要

5. 結果報告
   処理結果を一覧形式でユーザーに報告する:
   - Issue番号、タイトル、判定結果（story/task/矛盾/判定不能）、実行したラベル操作

## 注意点

- 各Issueの情報取得は可能な限り並列実行すること
- story/task以外のラベルは一切変更しないこと
- 矛盾が検出された場合は、両方のラベルを削除してエラーメッセージを表示すること
- 既に正しいラベルが設定されている場合は操作不要であることを報告すること
- ラベル操作には `issue-update.sh` の `--add-label` / `--remove-label` を使用すること
