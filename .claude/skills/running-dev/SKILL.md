---
name: running-dev
description: タスクIssueの実装からPR作成・レビュー対応・振り返りまでを一括実行します。タスクIssueを自動的に完了させる場合に使用してください。
layer: workflow
argument-hint: [GitHub IssueのURLまたは番号]
---
## 手順

このチェックリストをコピーし、進行状況の追跡に使用してください：

タスク進捗：
- [ ] ステップ1：GitHub Issueの番号を決定する
- [ ] ステップ2：`in-progress-by-claude` ラベルを付与する
- [ ] ステップ3：Issueの有効性チェックを行う
- [ ] ステップ4：既存PRの確認を行う
- [ ] ステップ5：`/coding` コマンドの手順を実行する（実装・テスト）
- [ ] ステップ6：`/reviewing` コマンドの手順を実行する（自己レビュー）
- [ ] ステップ7：`/creating-pr` コマンドの手順を実行する（PR作成）
- [ ] ステップ8：PRがマージされるまで `/fixing-pr` を繰り返し実行し、マージ条件を満たしたらマージする
- [ ] ステップ9：`/running-retro` コマンドの手順を実行する（振り返り）

1. GitHub Issueの番号を決定する。
    - 引数でIssue番号が指定されていればそれを使用。
    - 引数がIssue URLならURLから番号を抽出。
    - 引数未指定の場合、以下の条件でIssueを自動選択:
        - `assign-to-claude` ラベルが付いている
        - `in-progress-by-claude` ラベルが付いていない
        - open状態である
        - 上記条件に合致する最も古いIssueを1件選択
    - 自動選択の対象がなければ処理を終了。
2. 対象Issueに `in-progress-by-claude` ラベルを付与する。
3. Issueの有効性チェックを行う。
    - **親Issueの状態確認**: 親Issueがクローズ済みなら「対応不要の可能性あり」。
    - **マージ済みPRの確認**: Issue番号に関連するマージ済みPRを検索し、同等の変更が既にマージされていないか検証。
    - **コードベースとの整合性**: 変更対象が既に存在しない、または期待通りの状態なら「対応不要の可能性あり」。
    - **判定**: 「対応不要の可能性あり」なら理由を添えてユーザーに確認。対応不要と判断されたら `assign-to-claude` ラベルと `in-progress-by-claude` ラベルを削除し終了。有効なら手順4へ。
4. 既存PRの確認を行う。
    - Issue番号に対応するopen状態のPRを検索。複数あれば最も新しいものを選択。
    - PR見つかれば手順8へ、なければ手順5へ。
5. `/coding` コマンドを実行（実装・テスト）。
6. `/reviewing` コマンドを実行（自己レビュー）。
7. `/creating-pr` コマンドを実行（PR作成）。
8. PRがマージされるまで、CIの結果やレビューコメントに応じて `/fixing-pr` を繰り返し実行。
    - `/fixing-pr` の完了条件を全て満たしたら、ブランチ保護ルールを確認する。
    - マージ条件（必要な承認数等）を満たしている場合は、速やかにマージを実行する。
    - マージ条件を満たしていない場合（承認待ち等）は、ユーザーに状況を報告しレビュアーの対応を待つ。
    - PRがマージされずにクローズされた場合は報告し作業中断。
9. PRマージ後、`/running-retro` コマンドを実行（振り返り）。

## エージェント利用ルール

- ソースコードの実装は `coding-specialist` エージェントに依頼すること
    - 可能な限り複数エージェントで並列実行すること
    - 複数エージェントが作業する際は次の作業などで競合するため注意
        - 品質チェック手順の実行
        - 同一ファイルの編集
- 文章（プルリクエストやタスクの内容など）を考える際は `document-specialist` エージェントに依頼すること
- スキル（`.claude/skills/` 配下の定義）の作成・レビュー・改善は `skill-specialist` エージェントに依頼すること
- 実装完了後、PR作成前に `/reviewing` コマンドで自己レビューを実施すること
- 会話セッション終了時に `/running-retro` コマンドで振り返りを実行すること
    - 振り返りで改善点が見つかった場合はGitHub Issueを作成すること
    - 改善不要と判断した場合はIssueを作成しないこと

## ラベルの説明

- `assign-to-claude`: Claudeに自動対応させるために付与するラベル。Issue自動選択時の条件として使用される
- `in-progress-by-claude`: Claudeが対応中であることを示すラベル。対応開始時に付与し、重複対応を防止する

## 注意点
- エラー発生時は報告し作業を中断する。
