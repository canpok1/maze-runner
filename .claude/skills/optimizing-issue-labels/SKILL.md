---
name: optimizing-issue-labels
description: GitHub Issueのラベル（`story`/`task`）を内容に基づいて最適化します。Issueのラベルが未設定または誤っている場合に使用してください。
layer: feature
argument-hint: "<Issue番号...>"
---

## 手順

1. 引数の確認
   - `$ARGUMENTS` からIssue番号を取得する（スペース区切り、`#` プレフィックスは除去）
   - 引数未指定時は「Issue番号を指定してください」と報告して終了

2. 各Issueについて情報取得（可能な限り並列実行）
   - `github` スキル（`issue-get.sh`）でIssueの内容（タイトル、本文、ラベル）を取得
   - `github` スキル（`issue-sub-issues.sh`）でサブIssueの有無を確認

3. 各Issueの判定
   以下の基準で story/task を判定する。

   **ラベルの定義**:
   - `story` ラベルは、ストーリー（親Issue）にのみ付与する
       - ユーザーの要望やユーザーに提供する価値が記載されているIssue（WHYが中心）
   - `task` ラベルは、タスクIssue（サブIssue）にのみ付与する
       - 作業者に依頼できるくらいに実装方法が具体化されているIssue（HOWが中心）

   **構造的な判定基準**:

   **story候補の条件**:
   - サブIssueが1つ以上存在する
   - 本文がユーザーストーリー形式（「〜として、〜したい」等）で記述されている
   - 受け入れ条件セクションがある

   **task候補の条件**:
   サブIssueを持たないIssueであり、かつ以下のいずれかの条件を満たすもの:
   - 本文に「親ストーリー」セクションまたは親Issueへの参照（`#数字`形式でのリンク）がある
   - 具体的な実装内容・完了条件が記述されている

   **判定結果**:
   - story候補のみ満たす → `story` ラベル付与、`task` ラベル削除
   - task候補のみ満たす → `task` ラベル付与、`story` ラベル削除
   - 両方満たす（矛盾） → 両ラベル削除、エラー表示
   - どちらも満たさない → ラベル変更なし、判定不能を報告

4. ラベル操作
   - `github` スキル（`issue-update.sh`）の `--add-label` / `--remove-label` を使用
   - story/task以外のラベルは一切変更しない
   - 既に正しいラベルが付与されている場合は変更不要

5. 結果報告
   処理結果を一覧形式でユーザーに報告する:
   - Issue番号、タイトル、判定結果（story/task/矛盾/判定不能）、実行したラベル操作
