---
description: タスクIssueの実装からPR作成・レビュー対応・振り返りまでを一括実行する
argument-hint: [GitHub IssueのURLまたは番号]
---
## 手順
1. GitHub Issueの番号を決定する。
    - 引数でIssue番号が指定されている場合、その番号を使用する。
    - 引数でIssue URLが指定されている場合、URLパスからIssue番号を抽出する。
    - 引数が未指定の場合、以下の条件でIssueを自動選択する:
        - `assign-to-claude` ラベルが付いている
        - `in-progress-by-claude` ラベルが付いていない
        - open状態である
        - 上記条件に合致するIssueから最も古いものを1件選択する
    - 自動選択の対象Issueがない場合は「対象タスクがありません」とユーザーに通知し、処理を終了する。
2. Issueの有効性チェックを行う。
    - 手順1で取得したIssueについて、着手前に以下の観点で有効性を検証する。
    - **親Issue（ストーリー）の状態確認**:
        - `github` スキルの `github-graphql.sh` を使用して親Issueを取得する（GraphQLの `parentIssue` フィールドを使用）。
        - 親Issueが存在し、かつクローズ済みの場合は「対応不要の可能性あり」と判断する。
    - **マージ済みPRによる重複確認**:
        - `github` スキルの `pr-search.sh` を使用して、Issue番号に関連するマージ済みPRを検索する（検索クエリ例: `is:merged <Issue番号>`）。
        - 該当するPRが見つかった場合、PRの内容を確認し、同等の変更が既にマージされていないか検証する。
    - **コードベースとの整合性確認**:
        - Issueの内容（受け入れ条件や変更対象）を現在のコードベースと照らし合わせる。
        - 変更対象のファイルや機能が既に存在しない、または既に期待通りの状態になっている場合は「対応不要の可能性あり」と判断する。
    - **判定と対応**:
        - 上記の検証で「対応不要の可能性あり」と判断された場合、具体的な理由を添えてユーザーに確認する。
        - ユーザーが「対応不要」と判断した場合は、Issueから `assign-to-claude` ラベルを削除し、処理を終了する。
        - ユーザーが「対応する」と判断した場合、または有効性に問題がない場合は手順3へ進む。
3. 既存PRの確認を行う。
    - 手順1で取得したIssue番号に対応するopen状態のPRを検索する（`github` スキルの `pr-search.sh` を使用）。複数見つかった場合は、最も新しく更新されたものを1件選択する。
    - PRが見つかった場合は、そのPRを対象として手順6へ進む。
    - PRが見つからなかった場合は手順4へ進む。
4. `/develop` コマンドの手順を実行する（実装・テスト・自己レビュー）。
    - 手順1で取得したIssue番号を引数として渡す。
5. `/create-pr` コマンドの手順を実行する（PR作成）。
6. PRがマージされるまで、CIの結果やレビューコメントに応じて `/fix-pr` コマンドを繰り返し実行する。
    - PRがマージされずにクローズされた場合は、その時点でユーザーに報告し、作業を中断する。
7. PRがマージされたら、`/retro` コマンドの手順を実行する（振り返り）。

## 注意点
- 各ステップ間でユーザーに確認を求めず、自律的に進行すること（ただし、手順2の有効性チェックで対応可否に疑問が生じた場合は例外としてユーザーに確認する）。
- 各コマンドの詳細な手順は、それぞれのコマンド定義に従うこと。
- いずれかのステップでエラーが発生した場合は、その時点でユーザーに報告し、作業を中断すること。
